<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ジャパンランナー - 日本文化を駆け抜けるエンドレスランナーゲーム</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="game-container">
        <div class="game-start-screen">
            <h1>ジャパンランナー</h1>
            <p>日本文化を駆け抜けるエンドレスランナーゲーム</p>
            <button id="start-button">ゲームスタート</button>
            <div class="instructions">
                <h2>操作方法</h2>
                <p>← → : 左右移動</p>
                <p>↑ : ジャンプ</p>
                <p>↓ : スライディング</p>
            </div>
        </div>
        
        <div class="game-play-screen">
            <canvas id="game-canvas"></canvas>
            <div class="game-stats">
                <div class="score">スコア: <span id="score">0</span></div>
                <div class="coins">コイン: <span id="coins">0</span></div>
                <div class="distance">距離: <span id="distance">0</span>m</div>
            </div>
        </div>
        
        <div class="game-over-screen">
            <h2>ゲームオーバー</h2>
            <div class="final-score">最終スコア: <span id="final-score">0</span></div>
            <div class="high-score">ハイスコア: <span id="high-score">0</span></div>
            <button id="restart-button">もう一度プレイ</button>
        </div>
    </div>
    
    <div class="loading-screen">
        <div class="loading-text">読み込み中...</div>
        <div class="progress-bar">
            <div class="progress"></div>
        </div>
    </div>

    <!-- ゲームスクリプト -->
    <script src="js/game.js"></script>
    <script type="module" src="js/japanese-elements.js"></script>
    <script src="js/placeholder-images.js"></script>
    <script src="js/game-integration.js"></script>
    <script src="js/ui-controls.js"></script>
</body>
</html>

/**
 * ジャパンランナー - メインゲームスクリプト
 * サブウェイサーファーズのようなゲームメカニクスに日本文化要素を組み込んだエンドレスランナーゲーム
 */

// ゲームの状態管理
const GAME_STATE = {
    LOADING: 0,
    START: 1,
    PLAYING: 2,
    GAME_OVER: 3
};

// ゲームの設定
const GAME_CONFIG = {
    // キャンバス設定
    canvasWidth: 800,
    canvasHeight: 600,
    
    // プレイヤー設定
    playerWidth: 60,
    playerHeight: 90,
    playerStartX: 400,
    playerStartY: 450,
    playerSpeed: 8,
    jumpForce: 20,
    gravity: 1,
    
    // ゲーム設定
    initialSpeed: 5,
    maxSpeed: 15,
    speedIncrement: 0.0005,
    laneWidth: 200,
    lanes: 3,
    
    // 障害物設定
    obstacleMinDistance: 300,
    obstacleMaxDistance: 600,
    
    // コイン設定
    coinChance: 0.7,
    coinValue: 10,
    
    // パワーアップ設定
    powerupChance: 0.05,
    powerupDuration: 5000,
};

// ゲームクラス
class JapanRunner {
    constructor() {
        // DOM要素の取得
        this.canvas = document.getElementById('game-canvas');
        this.ctx = this.canvas.getContext('2d');
        this.startScreen = document.querySelector('.game-start-screen');
        this.playScreen = document.querySelector('.game-play-screen');
        this.gameOverScreen = document.querySelector('.game-over-screen');
        this.loadingScreen = document.querySelector('.loading-screen');
        this.progressBar = document.querySelector('.progress');
        
        // ゲーム状態の初期化
        this.gameState = GAME_STATE.LOADING;
        this.score = 0;
        this.coins = 0;
        this.distance = 0;
        this.speed = GAME_CONFIG.initialSpeed;
        
        // ゲームループの開始
        requestAnimationFrame((time) => this.gameLoop(time));
    }
    
    // ゲームループ
    gameLoop(currentTime) {
        // 時間差分の計算
        const deltaTime = currentTime - this.lastTime;
        this.lastTime = currentTime;
        
        // ゲームが実行中の場合のみ更新
        if (this.gameState === GAME_STATE.PLAYING) {
            // ゲーム状態の更新
            this.update(deltaTime);
            
            // 描画
            this.render();
            
            // 次のフレームをリクエスト
            requestAnimationFrame((time) => this.gameLoop(time));
        }
    }
}

// プレイヤークラス
class Player {
    constructor(x, y, width, height) {
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
        this.lane = 1; // 中央レーン
        this.isJumping = false;
        this.isSliding = false;
        this.jumpVelocity = 0;
        this.slideTime = 0;
        this.hasPowerup = false;
        this.powerupType = null;
        this.powerupEndTime = 0;
    }
    
    // プレイヤーの更新
    update(deltaTime, keys) {
        // 左右移動
        if (keys.ArrowLeft) {
            this.moveLeft();
        } else if (keys.ArrowRight) {
            this.moveRight();
        }
        
        // ジャンプ
        if (keys.ArrowUp && !this.isJumping) {
            this.jump();
        }
        
        // ジャンプ中の処理
        if (this.isJumping) {
            this.y -= this.jumpVelocity;
            this.jumpVelocity -= GAME_CONFIG.gravity;
            
            // 着地判定
            if (this.y >= GAME_CONFIG.playerStartY) {
                this.y = GAME_CONFIG.playerStartY;
                this.isJumping = false;
                this.jumpVelocity = 0;
            }
        }
        
        // スライディング
        if (keys.ArrowDown && !this.isJumping && !this.isSliding) {
            this.slide();
        }
        
        // スライディング中の処理
        if (this.isSliding) {
            this.slideTime -= deltaTime;
            if (this.slideTime <= 0) {
                this.isSliding = false;
                this.height = GAME_CONFIG.playerHeight;
            }
        }
        
        // レーンに基づいてX座標を更新
        this.x = (this.lane * GAME_CONFIG.laneWidth) - (GAME_CONFIG.laneWidth / 2);
    }
}

/**
 * ジャパンランナー - 日本文化要素
 * ゲームに日本文化要素を追加するためのデータと関数
 */

// 背景テーマ
const BACKGROUNDS = {
    // 東京の街並み
    TOKYO: {
        name: '東京',
        colors: ['#87CEEB', '#E0F7FA'],
        elements: [
            { name: '東京タワー', probability: 0.3 },
            { name: 'スカイツリー', probability: 0.2 },
            { name: '高層ビル', probability: 0.8 },
            { name: '電車', probability: 0.5 }
        ]
    },
    
    // 富士山と田園風景
    FUJI: {
        name: '富士山',
        colors: ['#E0F7FA', '#B3E5FC'],
        elements: [
            { name: '富士山', probability: 1.0 },
            { name: '桜の木', probability: 0.6 },
            { name: '田んぼ', probability: 0.7 },
            { name: '鳥居', probability: 0.3 }
        ]
    },
    
    // 寺社仏閣
    TEMPLE: {
        name: '寺社仏閣',
        colors: ['#FFE0B2', '#FFCCBC'],
        elements: [
            { name: '五重塔', probability: 0.5 },
            { name: '鳥居', probability: 0.7 },
            { name: '石灯籠', probability: 0.8 },
            { name: '枯山水', probability: 0.4 }
        ]
    }
};

// 障害物
const OBSTACLES = {
    // 建造物
    STRUCTURES: [
        { name: '鳥居', width: 80, height: 120, canJumpOver: true, canSlideUnder: false },
        { name: '石灯籠', width: 50, height: 80, canJumpOver: true, canSlideUnder: false },
        { name: '竹垣', width: 100, height: 60, canJumpOver: true, canSlideUnder: false }
    ],
    
    // 乗り物
    VEHICLES: [
        { name: '路面電車', width: 120, height: 70, canJumpOver: true, canSlideUnder: false },
        { name: '人力車', width: 70, height: 60, canJumpOver: true, canSlideUnder: false }
    ],
    
    // 自然物
    NATURE: [
        { name: '岩', width: 60, height: 50, canJumpOver: true, canSlideUnder: false },
        { name: '竹', width: 40, height: 150, canJumpOver: false, canSlideUnder: false }
    ]
};

// 収集アイテム
const COLLECTIBLES = {
    // 通常コイン
    COINS: [
        { name: '五円玉', value: 5, probability: 0.8 },
        { name: '小判', value: 20, probability: 0.2 }
    ],
    
    // パワーアップ
    POWERUPS: [
        { name: '招き猫', effect: 'MAGNET', duration: 8000, probability: 0.3 },
        { name: '紙風船', effect: 'FLIGHT', duration: 5000, probability: 0.2 },
        { name: 'だるま', effect: 'DOUBLE_SCORE', duration: 10000, probability: 0.2 },
        { name: '雲雀の草履', effect: 'SPEED_BOOST', duration: 6000, probability: 0.3 }
    ]
};

// キャラクター
const CHARACTERS = [
    { name: '忍者', speed: 1.1, jumpHeight: 1.0, slideLength: 1.0 },
    { name: '侍', speed: 0.9, jumpHeight: 1.2, slideLength: 0.9 },
    { name: '巫女', speed: 1.0, jumpHeight: 1.1, slideLength: 1.1 },
    { name: '現代の学生', speed: 1.0, jumpHeight: 1.0, slideLength: 1.0 }
];
